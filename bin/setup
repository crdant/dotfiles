#!/bin/sh

SELFPATH=$(cd -P -- "$(dirname -- "$0")" && pwd -P) && SELFPATH=${SELFPATH}/$(basename -- "$0")
SELFDIR=`dirname ${SELFPATH}`
DOTFILES=`dirname ${SELFDIR}`

# backup the files if they exist
mkdir ${HOME}/.setup.bak
cp ${HOME}/.ackrc ${HOME}/.emacs ${HOME}/.ssh/config ${HOME}/.zshrc ${HOME}/.zshenv ${HOME}/.setup.bak

# make sure the SSH config directory exists with appropriate permissions
mkdir ${HOME}/.ssh
chmod 700 ${HOME}/.ssh

# setup various dotfiles

ln -sf ${DOTFILES}/ackrc ${HOME}/.ackrc
ln -sf ${DOTFILES}/curlrc ${HOME}/.curlrc
ln -sf ${DOTFILES}/editorconfig ${HOME}/.editorconfig
ln -sf ${DOTFILES}/emacs ${HOME}/.emacs
ln -sf ${DOTFILES}/ssh/config ${HOME}/.ssh/config
ln -sf ${DOTFILES}/gitconfig ${HOME}/.gitconfig
ln -sf ${DOTFILES}/packerconfig ${HOME}/.packerconfig
ln -sf ${DOTFILES}/tmproperties ${HOME}/.tm_properties
ln -sf ${DOTFILES}/zshrc ${HOME}/.zshrc
ln -sf ${DOTFILES}/zshenv ${HOME}/.zshenv

# confirm SSH with my private key will be allowed
cat ${DOTFILES}/ssh/id_rsa_4096.pub >> ${HOME}/.ssh/authorized_keys
chmod 600 ${HOME}/.ssh/authorized_keys

# add oh-my-zsh with from my github respository, assuming the dotfiles repository is in the
# same repository to use for the source code
OHMYZSH=`dirname ${DOTFILES}`/oh-my-zsh
git clone git@github.com:crdant/oh-my-zsh.git ${OHMYZSH}
ln -sF ${OHMYZSH} ${HOME}/.oh-my-zsh

# add customized Terminal.app configuration (need to make this only execute on Macs)
cp ${HOME}/Library/Preferences/com.apple.Terminal.plist ${HOME}/.setup.bak
ln -sf ${DOTFILES}/com.apple.Terminal.plist ${HOME}/Library/Preferences/com.apple.Terminal.plist

# setup some directories
mkdir ${HOME}/Source
ln -s ${HOME}/Source ${HOME}/src
mkdir ${HOME}/Source/learning
mkdir "${HOME}/Virtual Box VMs"

# install packages
$SELFDIR/packages.sh
